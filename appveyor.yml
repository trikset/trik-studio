version: 2.1.20.{branch}-{build}
clone_folder: c:\qreal
test: off

clone_depth: 1
#shallow_clone: true

cache:
  - C:\ProgramData\chocolatey\bin -> appveyor.yml
  - C:\ProgramData\chocolatey\lib -> appveyor.yml
  - C:\Users\appveyor\.ccache

environment:
  global:
    APPVEYOR_CACHE_ENTRY_ZIP_ARGS:
    APPVEYOR_SAVE_CACHE_ON_ERROR: true
    PYTHON_PATH: C:\Python27
    PYTHON_LIB: C:\Python27\libs
    PROJECT_FILE: qrealRobots
  matrix:
#    - PROJECT_FILE: qreal
      - MINGW: C:\Qt\Tools\mingw492_32
        QTDIR: C:\Qt\5.6.3\mingw49_32
      - MINGW: C:\Qt\Tools\mingw530_32
        QTDIR: C:\Qt\5.11.1\mingw53_32

configuration:
#  - debug
  - release
install:
  - set PATH=%QTDIR%\bin;%MINGW%\bin;C:\msys64\usr\bin;%PATH%
  - pacman --verbose --noconfirm --sync ccache
#--refresh --sysupgrade --ask=20
  - ccache.exe -V || appveyor DownloadFile "http://alam.srb2.org/ccache.exe" -FileName "ccache.exe" && xcopy /Y /V /I ccache.exe %MINGW%\bin
  - ccache -VM 900M

before_build:
  - git submodule update --init --recursive


build_script:
  - qmake %PROJECT_FILE%.pro -spec win32-g++ CONFIG+=%CONFIGURATION% QMAKE_CXX="ccache g++"
  - mingw32-make -j2 qmake_all
  - mingw32-make -j2 all

after_build:
  - ccache -s


artifacts:
 - path: bin\$(configuration)
   name: qreal-$(configuration)-$(PROJECT_FILE)
